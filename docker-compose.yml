services:
  deployment-manager:
    build:
      context: https://github.com/Ralfino26/nextjs-selhost-deployer.git#main
      dockerfile: Dockerfile
    container_name: deployment-manager
    ports:
      - "${PORT:-3000}:3000"
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      # Web interface authentication (ONLY these in env)
      - WEB_USERNAME=${WEB_USERNAME:-ralf}
      - WEB_PASSWORD=${WEB_PASSWORD:-supersecret}
    volumes:
      # Mount Docker socket to allow container management
      - /var/run/docker.sock:/var/run/docker.sock
      # Mount projects directory (configured via web interface, default: /srv/vps/websites)
      - ./projects:/srv/vps/websites
      # Mount data directory for port registry (optional)
      - ./data:/app/data
    networks:
      - deployment-network
    # Access Docker socket (required for dockerode)
    # The container needs to be able to execute docker commands
    # Using privileged mode for simplicity - in production consider docker-in-docker or socket mounting with proper permissions
    privileged: true
    # Alternative: Add user to docker group (requires host setup)
    # user: "1000:999"  # Adjust to match docker group on host

networks:
  deployment-network:
    driver: bridge

